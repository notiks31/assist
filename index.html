<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>환승 어시스트 (Transfer Assist)</title>
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="app-container">
    <div class="top-map-area">
        <div id="map" style="width:100%; height:100%;"></div>

        <div class="map-badge" id="map-status-text">📍 내 위치 찾는 중...</div>

        <button class="bus-test-btn" onclick="simulateRealTimeBus()">🚌 버스 보기</button>
    </div>

    <div class="bottom-content-area">

        <div id="step-1" class="screen active">
            <div class="content-header">어디로 갈까요?</div>
            
            <div class="input-group">
                <div class="input-box">
                    <span>🔵</span> 
                    <input type="text" id="start-input" placeholder="출발지 검색" onkeyup="filterPlaces('start-input', 'start-list')">
                </div>
                <div id="start-list" class="suggestion-list"></div>
            </div>

            <div class="input-group">
                <div class="input-box">
                    <span>🔴</span> 
                    <input type="text" id="end-input" placeholder="도착지 검색" onkeyup="filterPlaces('end-input', 'end-list')">
                </div>
                <div id="end-list" class="suggestion-list"></div>
            </div>
            
            <div style="margin-top: 20px;">
                <div style="font-size:12px; color:#888; margin-bottom:10px;">즐겨찾기</div>
                
                <div class="favorite-box">
                    <div style="flex:1;" onclick="useFavorite()">
                        <span>⭐</span> 
                        <span id="fav-title" style="font-weight:bold; margin-left:5px;">집 → 학교</span><br>
                        <span id="fav-desc" style="font-size:11px; color:#aaa; margin-left:25px;">33번 버스 이용</span>
                    </div>
                    <div class="favorite-edit-btn" onclick="editFavorite(event)">⚙️</div>
                </div>
            </div>

            <button class="btn btn-primary" onclick="goToStep(2)">경로 찾기</button>
        </div>

        <div id="step-2" class="screen">
            <div class="content-header">
                <span>추천 경로</span>
                <span style="font-size:14px; color:var(--primary);">24분 소요</span>
            </div>
            <div class="timeline-container">
                <div class="timeline-left">
                    <span class="timeline-time">12:36</span>
                    <div class="timeline-dot active"></div>
                    <div class="timeline-line active"></div>
                </div>
                <div class="timeline-right">
                    <div class="location-title" id="route-start-text">출발지</div>
                </div>
                <div class="timeline-left">
                     <span class="timeline-icon">🚌</span>
                </div>
                <div class="timeline-right">
                    <div class="location-title">33번 버스 이동</div>
                </div>
                 <div class="timeline-left">
                    <div class="timeline-dot"></div>
                </div>
                <div class="timeline-right">
                    <div class="location-title" id="route-end-text">도착지</div>
                </div>
            </div>

            <button class="btn btn-primary" onclick="goToStep(3)">안내 시작</button>
            <button class="btn btn-outline" onclick="goToStep(1)">뒤로 가기</button>
        </div>

        <div id="step-3" class="screen">
            <div style="text-align:center; padding-top:50px;">
                <h3>안내 예시 화면입니다</h3>
                <button class="btn btn-primary" onclick="goToStep(1)">처음으로</button>
            </div>
        </div>

    </div>
</div>

<script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=9d433a391319ff5dd19c3ae6940148df"></script>

<script>
    /* =========================================
       [기능 1] 지도 및 현재 위치(Geolocation)
       ========================================= */
    var mapContainer = document.getElementById('map');
    var mapOption = { 
        center: new kakao.maps.LatLng(37.566826, 126.9786567), // 기본값(서울)
        level: 4 
    };
    var map = new kakao.maps.Map(mapContainer, mapOption);
    
    // 내 위치 마커
    var myMarker = new kakao.maps.Marker({
        position: map.getCenter(), 
        map: null // 처음엔 숨김
    });

    // 브라우저 GPS로 현재 위치 가져오기
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            var lat = position.coords.latitude;
            var lon = position.coords.longitude;
            var locPosition = new kakao.maps.LatLng(lat, lon);

            // 지도 중심 이동 및 마커 표시
            map.setCenter(locPosition);
            myMarker.setPosition(locPosition);
            myMarker.setMap(map);
            
            document.getElementById('map-status-text').innerText = "📍 현재 내 위치";

        }, function(error) {
            // GPS 차단 시 기본 위치(부산 서면)로
            var fallbackLoc = new kakao.maps.LatLng(35.1578, 129.0600);
            map.setCenter(fallbackLoc);
            document.getElementById('map-status-text').innerText = "📍 위치 권한 없음 (기본값)";
        });
    } else {
        document.getElementById('map-status-text').innerText = "📍 GPS 미지원";
    }


    /* =========================================
       [기능 2] 즐겨찾기 수정 및 사용
       ========================================= */
    // 즐겨찾기 데이터 변수
    let favoriteData = {
        title: "집 → 학교",
        desc: "33번 버스 이용",
        start: "집",
        end: "학교"
    };

    // 즐겨찾기 클릭 시 입력창 채우기
    function useFavorite() {
        document.getElementById('start-input').value = favoriteData.start;
        document.getElementById('end-input').value = favoriteData.end;
        alert(`'${favoriteData.title}' 경로가 설정되었습니다.`);
    }

    // 즐겨찾기 수정 (톱니바퀴 클릭)
    function editFavorite(event) {
        event.stopPropagation(); // 부모 클릭 방지
        
        const newTitle = prompt("즐겨찾기 이름을 입력하세요:", favoriteData.title);
        if(!newTitle) return; // 취소하면 종료

        const newDesc = prompt("설명을 입력하세요:", favoriteData.desc);
        
        // 데이터 업데이트
        favoriteData.title = newTitle;
        if(newDesc) favoriteData.desc = newDesc;

        // 화면 업데이트
        document.getElementById('fav-title').innerText = favoriteData.title;
        document.getElementById('fav-desc').innerText = favoriteData.desc;
    }


    /* =========================================
       [기능 3] 실시간 버스 시뮬레이션 (핵심!)
       ========================================= */
    // 실제 버스 API는 서버(Backend)가 필요합니다. 
    // 여기서는 HTML만으로 작동하는 '시뮬레이션'을 보여드립니다.
    
    let busMarker = null; // 버스 마커

    function simulateRealTimeBus() {
        alert("🚌 실시간 버스 위치를 지도에 표시합니다. (시뮬레이션)");

        // 1. 현재 지도 중심 가져오기
        var center = map.getCenter();
        
        // 2. 버스 아이콘 이미지 설정 (카카오 예제 이미지)
        var imageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/busStop.png', 
            imageSize = new kakao.maps.Size(24, 35); 
        var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);

        // 3. 버스 마커 생성
        if(busMarker) busMarker.setMap(null); // 기존 마커 삭제
        busMarker = new kakao.maps.Marker({
            position: center,
            image: markerImage,
            map: map
        });

        // 4. 버스 움직이기 (0.5초마다 조금씩 이동)
        let step = 0;
        const interval = setInterval(() => {
            // 현재 위치에서 조금씩 위/오른쪽으로 이동 계산
            const newLat = center.getLat() + (step * 0.0001);
            const newLng = center.getLng() + (step * 0.0001);
            const newPos = new kakao.maps.LatLng(newLat, newLng);
            
            busMarker.setPosition(newPos); // 마커 이동
            map.panTo(newPos); // 지도도 따라가기
            
            document.getElementById('map-status-text').innerText = `🚌 버스 이동 중... (속도 40km)`;

            step++;
            if(step > 50) { // 50번 움직이면 멈춤
                clearInterval(interval);
                document.getElementById('map-status-text').innerText = "📍 버스 도착!";
                alert("버스가 정류장에 도착했습니다!");
            }
        }, 300); // 0.3초마다 갱신
    }


    /* =========================================
       [기타] 화면 전환 및 자동완성
       ========================================= */
    function goToStep(stepNumber) {
        if(stepNumber === 2) {
             const startVal = document.getElementById('start-input').value;
             const endVal = document.getElementById('end-input').value;
             document.getElementById('route-start-text').textContent = startVal || "출발지";
             document.getElementById('route-end-text').textContent = endVal || "도착지";
        }

        document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
        const targetScreen = document.getElementById(`step-${stepNumber}`);
        if(targetScreen) targetScreen.classList.add('active');
    }

    const mockPlaces = ["냉정역 2호선", "서면역 1호선", "부산역", "동의대", "가야공원"];
    function filterPlaces(inputId, listId) {
        const input = document.getElementById(inputId);
        const list = document.getElementById(listId);
        const filter = input.value;
        if (!filter) { list.style.display = 'none'; return; }
        
        list.innerHTML = "";
        mockPlaces.filter(p => p.includes(filter)).forEach(item => {
            const div = document.createElement('div');
            div.className = 'suggestion-item';
            div.innerText = item;
            div.onclick = () => { input.value = item; list.style.display = 'none'; };
            list.appendChild(div);
        });
        list.style.display = 'block';
    }
</script>

</body>
</html>
